# Milestone v0.2.0: Publishing Workflow

**Status:** SHIPPED 2026-01-31
**Phases:** 7-10
**Total Plans:** 12

## Overview

Frictionless publishing from Obsidian with validation, rollback, and confidence that builds always pass.

**Architecture:** Three-layer pattern (justfile + hooks + optional skills)
- **justfile** — Deterministic commands that work standalone (`just publish`, `just preview`)
- **Claude hooks** — Safety gates and setup triggers (block dangerous git ops, run setup on `--init`)
- **Skills (optional)** — Agentic oversight when helpful (`/publish` wraps `just publish`)

## Phases

### Phase 7: Setup & Safety

**Goal:** Justfile foundation with configuration and git protection
**Depends on:** Phase 6 (v0.1.0 complete)
**Plans:** 2 plans

Plans:
- [x] 07-01: Justfile foundation and setup recipe
- [x] 07-02: Claude hooks (setup trigger, git safety)

**Details:**
- Interactive vault configuration with 3-tier detection (single/multi/manual)
- Config stored in `.claude/settings.local.json` (gitignored)
- Git safety hook blocks: `--force`, `reset --hard`, `checkout .`, `restore .`, `clean -f`
- Blocked operations logged to `.claude/blocked-operations.log`

### Phase 8: Core Publishing

**Goal:** User can publish posts from Obsidian with full validation pipeline
**Depends on:** Phase 7 (setup creates config that publish reads)
**Plans:** 5 plans

Plans:
- [x] 08-01: Publish recipe and post discovery
- [x] 08-02: Frontmatter validation and image handling
- [x] 08-03: Lint, build, commit, push pipeline with dry-run
- [x] 08-04: UAT gap closure (ANSI output, lint-staged, dry-run prompts)
- [x] 08-05: UAT gap closure (frontmatter type normalization)

**Details:**
- Post discovery via `status: - Published` in Obsidian frontmatter
- Frontmatter validation: title, pubDatetime, description required
- Image handling: wiki-links converted to markdown, images copied to `public/assets/blog/`
- Frontmatter normalization: author array → string, empty heroImage removed
- Pipeline: copy → lint → commit → build → push (with retry and rollback)
- Dry-run mode for complete preview without mutations

### Phase 9: Utilities

**Goal:** User can list posts and unpublish posts (preview already exists)
**Depends on:** Phase 7 (uses config), Phase 8 (unpublish reverses publish)
**Plans:** 3 plans

Plans:
- [x] 09-01: List posts utility with filters and validation display
- [x] 09-02: Unpublish recipe with confirmation and post-hook
- [x] 09-03: UAT gap closure (--published mode, exit codes, ANSI, terminology)

**Details:**
- `just list-posts` with filter modes: default (unpublished), `--all`, `--published`
- Validation status display with color-coded output
- `just unpublish <file>` commits but does NOT push (user controls timing)
- Obsidian source files untouched during unpublish

### Phase 10: Skills Layer

**Goal:** Optional Claude oversight wrapping justfile commands
**Depends on:** Phases 7-9 (skills wrap justfile recipes)
**Plans:** 2 plans

Plans:
- [x] 10-01: Full skill suite with stop hooks
- [x] 10-02: UAT gap closure (install pre-check, unpublish listing, startup hook)

**Details:**
- 5 skills: `/publish`, `/install`, `/maintain`, `/list-posts`, `/unpublish`
- All skills use `disable-model-invocation: true` (manual-only)
- Stop hooks verify build (publish) and install (setup) before skill exit
- SessionStart hook suggests `/install` when vault not configured

---

## Milestone Summary

**Key Decisions:**

- Three-layer architecture: justfile is source of truth, hooks add safety, skills add optional oversight
- Config in `.claude/settings.local.json` (project-local, gitignored)
- Git safety blocks 5 dangerous patterns with exit code 2
- Unpublish commits but doesn't push (safer design)
- All skills require manual invocation via disable-model-invocation
- frontmatter normalization handles Obsidian→Astro schema differences

**Issues Resolved:**

- ANSI escape codes displaying literally (added `echo -e` flag)
- lint-staged failing on markdown-only commits (added `--allow-empty`)
- Dry-run prompting interactively (auto-continue in dry-run mode)
- Frontmatter type mismatches (author array→string, empty heroImage removed)
- `--published` mode cross-referencing Obsidian instead of blog (direct blog scan)
- `/install` re-running setup when already configured (added pre-check)
- `/unpublish` asking for filename before showing list (added list step)
- Startup hook not firing (changed Setup→SessionStart event)

**Issues Deferred:**

- HOOK-04: Maintenance hook for health checks (future milestone)

**Technical Debt Incurred:**

None. All UAT issues were resolved via gap closure plans.

---

_For current project status, see .planning/ROADMAP.md_
