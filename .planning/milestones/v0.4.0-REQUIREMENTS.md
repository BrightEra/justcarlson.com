# Requirements Archive: v0.4.0 Obsidian + Blog Integration Refactor

**Archived:** 2026-02-02
**Status:** SHIPPED

This is the archived requirements specification for v0.4.0.
For current requirements, see `.planning/PROJECT.md` (Active section, or next milestone when defined).

---

# Requirements: v0.4.0 Obsidian + Blog Integration Refactor

**Defined:** 2026-02-01
**Core Value:** A clean, personal space to write â€” with a publishing workflow that just works.

## v0.4.0 Requirements

Requirements for the integration refactor. Each maps to roadmap phases.

### Library & Tooling

- [x] **LIB-01**: yq (mikefarah v4) installed as prerequisite in devcontainer and documented for local install
- [x] **LIB-02**: `scripts/lib/common.sh` created with shared functions
- [x] **LIB-03**: Validation functions consolidated (validate_frontmatter, validate_iso8601, extract_frontmatter)
- [x] **LIB-04**: Utility functions consolidated (slugify, color constants, config reading)
- [x] **LIB-05**: All scripts source common.sh instead of duplicating code

### Two-Way Sync

- [x] **SYNC-01**: `just unpublish` sets `draft: true` in Obsidian source file
- [x] **SYNC-02**: `just publish` sets `pubDatetime` at publish time (not template creation)
- [x] **SYNC-03**: `just publish` sets `draft: false` in Obsidian source file
- [x] **SYNC-04**: Backup created before modifying Obsidian files (atomic write pattern)
- [x] **SYNC-05**: `just unpublish --dry-run` previews changes without modifying files

### Schema Migration

- [x] **MIGR-01**: Discovery trigger changed from `status: Published` to `draft: false`
- [x] **MIGR-02**: Obsidian Post Template updated:
  - `draft: true` (source of truth, default unpublished)
  - `pubDatetime:` empty (set by publish script)
  - `created:` set at template time (when note made)
  - Remove `status` field
  - Remove `published` field (redundant with pubDatetime)
- [x] **MIGR-03**: Existing published posts migrated (add draft: false, preserve pubDatetime)
- [x] **MIGR-04**: Obsidian types.json updated (draft as boolean type)
- [x] **MIGR-05**: Obsidian Base/Category views configured to filter by draft field
- [x] **MIGR-06**: Astro content.config.ts updated (remove/deprecate status and published fields)
- [x] **MIGR-07**: Obsidian views validated against Kepano Meta patterns (Posts Base shows draft status, Category view works with `[[Posts]]`)

### Configuration

- [x] **CONF-01**: Author normalization uses config value (not hardcoded "Justin Carlson")
- [x] **CONF-02**: Constants centralized in common.sh (paths, patterns)

## Out of Scope

| Feature | Reason |
|---------|--------|
| Batch unpublish | Low priority, single-post workflow sufficient |
| modDatetime auto-tracking | Adds complexity, defer to v0.5.0+ |
| Interactive unpublish selection | Current workflow adequate |
| Multiple vault support | YAGNI for personal blog |

## Traceability

Which phases cover which requirements. Updated during roadmap creation.

| Requirement | Phase | Status |
|-------------|-------|--------|
| LIB-01 | Phase 15 | Complete |
| LIB-02 | Phase 15 | Complete |
| LIB-03 | Phase 15 | Complete |
| LIB-04 | Phase 15 | Complete |
| LIB-05 | Phase 15 | Complete |
| CONF-02 | Phase 15 | Complete |
| SYNC-01 | Phase 16 | Complete |
| SYNC-02 | Phase 16 | Complete |
| SYNC-03 | Phase 16 | Complete |
| SYNC-04 | Phase 16 | Complete |
| SYNC-05 | Phase 16 | Complete |
| CONF-01 | Phase 16 | Complete |
| MIGR-01 | Phase 17 | Complete |
| MIGR-02 | Phase 17 | Complete |
| MIGR-03 | Phase 17 | Complete |
| MIGR-04 | Phase 17 | Complete |
| MIGR-05 | Phase 17 | Complete |
| MIGR-06 | Phase 17 | Complete |
| MIGR-07 | Phase 17 | Complete |

**Coverage:**
- v0.4.0 requirements: 19 total
- Mapped to phases: 19
- Unmapped: 0

---

## Milestone Summary

**Shipped:** 19 of 19 v0.4.0 requirements
**Adjusted:** None
**Dropped:** None

---
*Archived: 2026-02-02 as part of v0.4.0 milestone completion*
