# Milestone v0.4.1: Image & Caption Support

**Status:** SHIPPED 2026-02-02
**Phases:** 18-19
**Total Plans:** 5

## Overview

| # | Phase | Goal | Requirements | Plans | Status |
|---|-------|------|--------------|-------|--------|
| 18 | Image & Caption Support | Hero images have alt text and optional captions | HERO-01, HERO-02, HERO-03, HERO-04, IMG-01 | 2 plans | Complete |
| 19 | Justfile Hero Image Support | Update justfile scripts to support heroImage, heroImageAlt, heroImageCaption | SCRIPT-01 | 3 plans | Complete |

## Phase Details

### Phase 18: Image & Caption Support

**Goal:** Hero images render with proper alt text and optional captions; inline figcaption works correctly.

**Requirements covered:**
- HERO-01: heroImage renders with proper alt text from frontmatter
- HERO-02: heroImage supports optional caption (figcaption)
- HERO-03: Schema includes `heroImageAlt` field
- HERO-04: Schema includes `heroImageCaption` field (optional)
- IMG-01: Inline `<figure>`/`<figcaption>` renders with correct styling

**Success criteria:**
1. Post with `heroImage` and `heroImageAlt` renders image with alt attribute
2. Post with `heroImageCaption` displays caption below hero image
3. Post without caption fields still renders hero image correctly (backward compatible)
4. Inline `<figure><figcaption>` in post body renders with `prose-figcaption` styling
5. Schema validates new optional fields without breaking existing posts

**Plans:** 2 plans

Plans:
- [x] 18-01-PLAN.md — Add hero image alt text and caption support (schema + PostDetails.astro)
- [x] 18-02-PLAN.md — Close UAT gaps (Obsidian template + test post) [gap closure]

### Phase 19: Justfile Hero Image Support

**Goal:** Update justfile scripts to support heroImage, heroImageAlt, heroImageCaption fields in publishing workflow.

**Requirements covered:**
- SCRIPT-01: Justfile scripts handle hero image fields during publish/sync operations

**Success criteria:**
1. Publishing workflow preserves heroImage, heroImageAlt, heroImageCaption fields
2. Bidirectional sync handles hero image fields correctly
3. New post template includes hero image fields
4. List posts command shows hero image status

**Plans:** 3 plans

Plans:
- [x] 19-01-PLAN.md — Update publish.sh for hero image field support
- [x] 19-02-PLAN.md — Fix Perl regex bug in normalize_frontmatter() [gap closure]
- [x] 19-03-PLAN.md — Fix wiki-link bracket handling in hero image functions [gap closure]

**Details:**
Extends existing `posts_are_identical()` and `normalize_frontmatter()` functions to handle the new hero image alt and caption fields. No changes to common.sh or other scripts needed - the existing `get_frontmatter_field()` function already handles any field name.

---

## Requirement Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| HERO-01 | 18 | Complete |
| HERO-02 | 18 | Complete |
| HERO-03 | 18 | Complete |
| HERO-04 | 18 | Complete |
| IMG-01 | 18 | Complete |
| SCRIPT-01 | 19 | Complete |

**Coverage:** 6/6 requirements mapped (100%)

---

## Milestone Summary

**Key Decisions:**

| Decision | Rationale | Outcome |
|----------|-----------|---------|
| Alt text fallback to title | Ensures every hero image has meaningful alt text for accessibility | ✓ Good |
| Optional schema fields | Maintains backward compatibility with existing posts | ✓ Good |
| Use [ \t]*\n instead of \s*$\n? | Avoid Perl variable interpolation bug | ✓ Good |
| Transform heroImage paths like inline images | Consistent handling, Astro compatibility | ✓ Good |
| Strip quotes and wiki-link brackets early | Sanitize before URL/basename checks for correct processing | ✓ Good |

**Issues Resolved:**

- Perl variable interpolation bug in normalize_frontmatter() (`$\n` interpreted as variable)
- Hero image paths not transformed from Obsidian format to web format
- Wiki-link format `[[image.png]]` not processed correctly

**Technical Debt:** None accumulated.

---
*Roadmap created: 2026-02-02*
*Shipped: 2026-02-02*
