---
phase: 09-utilities
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/list-posts.sh
  - justfile
autonomous: true

must_haves:
  truths:
    - "User can run `just list-posts` and see posts not yet published"
    - "User can run `just list-posts --all` and see all posts with Published status"
    - "User can run `just list-posts --published` and see posts already in blog repo"
    - "Each listed post shows title, date, status (ready/invalid), and validation errors"
    - "Posts are sorted by status (ready first) then by date (newest first)"
  artifacts:
    - path: "scripts/list-posts.sh"
      provides: "Post listing with filters and validation display"
      contains: "list_posts"
    - path: "justfile"
      provides: "list-posts recipe with flag support"
      contains: "list-posts"
  key_links:
    - from: "justfile"
      to: "scripts/list-posts.sh"
      via: "recipe invocation"
      pattern: "./scripts/list-posts.sh"
    - from: "scripts/list-posts.sh"
      to: ".claude/settings.local.json"
      via: "config loading"
      pattern: "jq.*obsidianVaultPath"
---

<objective>
Create the `just list-posts` utility that displays blog posts from Obsidian with their validation status.

Purpose: Allow user to see which posts are ready to publish, which are already published, and which have validation errors - all without running the full publish workflow.

Output: scripts/list-posts.sh script and justfile recipe with `--all` and `--published` flags.
</objective>

<execution_context>
@/home/jc/.claude/get-shit-done/workflows/execute-plan.md
@/home/jc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-utilities/09-CONTEXT.md
@.planning/phases/09-utilities/09-RESEARCH.md
@scripts/publish.sh
@justfile
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create list-posts.sh script</name>
  <files>scripts/list-posts.sh</files>
  <action>
Create a new bash script that lists blog posts with filtering and validation status.

**Structure (reuse patterns from publish.sh):**
1. Parse arguments: `--all`, `--published`, default (unpublished only)
2. Load config using same pattern as publish.sh (jq for settings.local.json)
3. Discover posts using same `perl -0777` pattern for `status: - Published` matching
4. For each post:
   - Extract title, pubDatetime using existing `extract_frontmatter_value` pattern
   - Run validation using same `validate_frontmatter` pattern
   - Check if already in blog repo using `git ls-files` pattern from RESEARCH.md
5. Filter based on flag:
   - Default: posts NOT in blog repo (unpublished/new)
   - `--published`: posts IN blog repo
   - `--all`: all posts with Published status
6. Sort by status (ready first), then by date (newest first)
7. Display as colored table matching publish.sh visual style:
   ```
   TITLE                                    DATE         STATUS
   ────────────────────────────────────────────────────────────────
   My New Post                              2026-01-15   Ready
   Draft Without Date                       (no date)    Invalid
     → Missing pubDatetime (required for post ordering)
   ```

**Key patterns to reuse from publish.sh:**
- Colors: RED, GREEN, YELLOW, CYAN, RESET (lines 6-10)
- Config loading: load_config() pattern (lines 394-422)
- Post discovery: discover_posts() with perl multiline match (lines 480-593)
- Validation: validate_frontmatter() (lines 261-310)
- Frontmatter extraction: extract_frontmatter_value() (lines 446-453)

**Output format (from CONTEXT.md):**
- Table with title (40 chars max, truncate with ...), date (12 chars), status (10 chars)
- Color: Green for Ready, Red for Invalid
- Invalid posts show error messages indented below with arrow (→)
- Use `echo -e` for ANSI interpretation (lesson from 08-04)

**Exit codes:**
- 0: Success (posts found and displayed)
- 1: Error (config missing, vault not found)
- Note: Empty results (no posts matching filter) is NOT an error, just display "No posts found"
  </action>
  <verify>
Run `./scripts/list-posts.sh --help` or `./scripts/list-posts.sh` - should display usage or results.
Verify script is executable: `ls -la scripts/list-posts.sh`
  </verify>
  <done>
Script exists, is executable, and handles all three modes (default, --all, --published).
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire list-posts recipe into justfile</name>
  <files>justfile</files>
  <action>
Add the list-posts recipe to justfile in a new "=== Utilities ===" section.

**Recipe definition:**
```just
# === Utilities ===

# List posts from Obsidian (default: unpublished, use --all or --published for more)
list-posts *args='':
    ./scripts/list-posts.sh {{args}}
```

**Placement:** After the "=== Publishing ===" section, before any future sections.

**Why this pattern:** Matches existing `publish` recipe that passes args through to script.
  </action>
  <verify>
Run `just --list` - should show `list-posts` recipe.
Run `just list-posts` - should invoke the script.
Run `just list-posts --all` - should pass flag through.
  </verify>
  <done>
`just list-posts`, `just list-posts --all`, and `just list-posts --published` all work correctly.
  </done>
</task>

</tasks>

<verification>
1. `just list-posts` shows only posts not yet in blog repo
2. `just list-posts --all` shows all posts with Published status
3. `just list-posts --published` shows only posts already in blog repo
4. Invalid posts display with red "Invalid" status and indented error messages
5. Valid posts display with green "Ready" status
6. Table columns are aligned correctly
7. Posts are sorted: ready posts first, then invalid; within each group by date descending
</verification>

<success_criteria>
- scripts/list-posts.sh exists and is executable
- justfile contains list-posts recipe with arg passthrough
- All three filter modes work correctly
- Output matches publish.sh visual style (colors, formatting)
- Exit codes follow convention (0 success, 1 error)
</success_criteria>

<output>
After completion, create `.planning/phases/09-utilities/09-01-SUMMARY.md`
</output>
