---
phase: 03-infrastructure
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - vercel.json
autonomous: true

must_haves:
  truths:
    - "No steipete.me references in vercel.json"
    - "No sweetistics.com references in vercel.json"
    - "CSP headers allow YouTube, Vimeo, Twitter embeds"
    - "Generic blog URL redirects preserved (YYYY/MM/DD/slug, blog/slug, etc.)"
  artifacts:
    - path: "vercel.json"
      provides: "Vercel deployment configuration"
      contains: "justcarlson"
  key_links:
    - from: "vercel.json"
      to: "YouTube/Vimeo/Twitter"
      via: "frame-src CSP directive"
      pattern: "youtube\\.com.*youtube-nocookie\\.com.*twitter"
---

<objective>
Clean up vercel.json by removing Peter-specific redirects and updating CSP headers.

Purpose: Current vercel.json contains redirects to steipete.me, Peter-specific post redirects, and CSP headers with steipete.me/sweetistics.com domains. Remove identity-specific config while preserving generic functionality.

Output: Updated vercel.json with clean redirects and CSP headers for justcarlson.com.
</objective>

<execution_context>
@/home/jc/.claude/get-shit-done/workflows/execute-plan.md
@/home/jc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-infrastructure/03-CONTEXT.md
@.planning/phases/03-infrastructure/03-RESEARCH.md

Decisions from CONTEXT.md:
- Clean slate approach: Remove all steipete-specific redirects
- Remove catch-all redirect (lines 58-67) that routes unknown domains to steipete.me
- Remove Peter-specific post redirects (a-new-beginning, llm-codes-transform-developer-docs, etc.)
- Keep generic blog URL patterns (YYYY/MM/DD/slug, /blog/:slug, etc.)
- CSP: Remove steipete.me and *.sweetistics.com from all directives
- CSP: Keep YouTube, Vimeo, Twitter, GitHub chart, Vercel services
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove Peter-specific redirects</name>
  <files>vercel.json</files>
  <action>
Remove the following redirects from vercel.json:

1. Line 9-15: steipete.me markdown redirect (has steipete.me host condition)
   ```json
   {
     "source": "/:path*.md",
     "has": [{ "type": "host", "value": "steipete.me" }],
     ...
   }
   ```

2. Lines 43-45: /blog/a-new-beginning redirect
   ```json
   {
     "source": "/blog/a-new-beginning/",
     "destination": "/posts/finding-my-spark-again",
     "permanent": true
   }
   ```

3. Lines 47-50: /posts/llm-codes-transform-developer-docs redirect

4. Lines 52-55: /posts/understanding-codebases-with-ai-gemini-workflow redirect

5. Lines 57-66: Catch-all domain redirect (massive regex routing unknown domains to steipete.me)
   ```json
   {
     "source": "/:path*",
     "has": [{ "type": "host", "value": "^(?!(steipete\\.me|www\\.steipete..." }],
     ...
   }
   ```

KEEP these generic redirects:
- /:year(\\d{4})/:month(\\d{2})/:day(\\d{2})/:slug → /posts/:slug (line 17-20)
- /blog/:year(\\d{4})/:month(\\d{2})/:day(\\d{2})/:slug → /posts/:slug (line 22-25)
- /blog/:slug([^\\/]+)$ → /posts/:slug (line 27-30)
- /categories/:category → /tags/:category (line 32-35)
- /tag/:tag → /tags/:tag (line 36)
- /20:year/:month/:day/:slug → /posts/:slug (line 38-41)

These are generic blog URL migration patterns, not Peter-specific.
  </action>
  <verify>grep -c "steipete" vercel.json | xargs test 0 -eq && echo "No steipete references found"</verify>
  <done>Peter-specific redirects removed, generic patterns preserved</done>
</task>

<task type="auto">
  <name>Task 2: Update CSP headers</name>
  <files>vercel.json</files>
  <action>
Update the Content-Security-Policy header value (line 143-144) to remove steipete.me and sweetistics.com:

Remove from ALL directives:
- `https://steipete.me`
- `https://*.sweetistics.com`

The CSP directives should become (condensed for readability):

- default-src: 'self' https://*.vercel.app
- script-src: 'self' 'unsafe-inline' 'unsafe-eval' blob: data: https://*.vercel.app https://platform.twitter.com https://cdn.syndication.twimg.com https://player.vimeo.com https://vercel.live https://va.vercel-scripts.com
- style-src: 'self' 'unsafe-inline' https://*.vercel.app https://platform.twitter.com
- img-src: 'self' data: https: blob: https://ghchart.rshah.org
- font-src: 'self' https://*.vercel.app
- connect-src: 'self' https://*.vercel.app https://platform.twitter.com https://player.vimeo.com https://vimeo.com https://vitals.vercel-insights.com https://va.vercel-scripts.com
- media-src: 'self' https://*.vercel.app https://player.vimeo.com https://vimeo.com
- object-src: 'none'
- frame-ancestors: 'none'
- frame-src: https://platform.twitter.com https://syndication.twitter.com https://player.vimeo.com https://vercel.live https://www.youtube.com https://youtube.com https://*.youtube.com https://www.youtube-nocookie.com https://*.youtube-nocookie.com
- worker-src: 'self' blob:

Note: The CSP value is on a single line in the JSON. Keep it that way, just remove the steipete.me and sweetistics.com references.
  </action>
  <verify>grep -c "sweetistics" vercel.json | xargs test 0 -eq && echo "No sweetistics references found"</verify>
  <done>CSP headers updated to remove steipete.me and sweetistics.com domains</done>
</task>

</tasks>

<verification>
1. Validate JSON: `jq . vercel.json > /dev/null && echo "Valid JSON"`
2. Verify no steipete/sweetistics references: `grep -E "steipete|sweetistics" vercel.json`
3. Verify YouTube still allowed: `grep "youtube" vercel.json`
4. Verify generic redirects preserved: `grep "posts/:slug" vercel.json`
</verification>

<success_criteria>
- vercel.json is valid JSON
- Zero references to steipete.me, sweetistics.com, or Peter-specific post slugs
- Generic blog URL redirects still present (YYYY/MM/DD/slug patterns)
- CSP still allows YouTube, Vimeo, Twitter, Vercel services
- Markdown content negotiation rewrites preserved (not identity-specific)
</success_criteria>

<output>
After completion, create `.planning/phases/03-infrastructure/03-02-SUMMARY.md`
</output>
