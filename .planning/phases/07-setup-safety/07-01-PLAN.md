---
phase: 07-setup-safety
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - justfile
  - scripts/setup.sh
  - .gitignore
autonomous: true

must_haves:
  truths:
    - "User can run `just` and see available commands"
    - "User can run `just setup` and configure Obsidian vault path interactively"
    - "Setup detects existing vaults and offers selection"
    - "Configured vault path is stored in .claude/settings.local.json"
    - "Local config file is gitignored"
  artifacts:
    - path: "justfile"
      provides: "Command runner recipes"
      contains: "setup:"
    - path: "scripts/setup.sh"
      provides: "Interactive vault configuration"
      min_lines: 50
    - path: ".claude/settings.local.json"
      provides: "User-specific vault path"
      contains: "obsidianVaultPath"
  key_links:
    - from: "justfile"
      to: "scripts/setup.sh"
      via: "setup recipe calls script"
      pattern: "./scripts/setup.sh"
    - from: "scripts/setup.sh"
      to: ".claude/settings.local.json"
      via: "writes config on completion"
      pattern: "settings.local.json"
---

<objective>
Create justfile foundation with setup recipe for interactive Obsidian vault configuration.

Purpose: Establish the command runner infrastructure that all v0.2.0 publishing workflows will use. Setup recipe enables user to configure their local Obsidian vault path once, which all other recipes will read.

Output: Working `just` command with setup recipe that detects and configures Obsidian vault path.
</objective>

<execution_context>
@/home/jc/.claude/get-shit-done/workflows/execute-plan.md
@/home/jc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/research/07-STACK.md
@.planning/phases/07-setup-safety/07-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create justfile with setup and development recipes</name>
  <files>justfile</files>
  <action>
Create `justfile` in project root with:

1. Header configuration:
   - `set dotenv-load := true` (load .env automatically)
   - `set shell := ["bash", "-uc"]` (strict bash mode)

2. Default recipe that runs `@just --list` to show available commands

3. Setup section with `setup` recipe that calls `./scripts/setup.sh`

4. Development section with recipes that wrap existing npm scripts:
   - `preview`: runs `npm run dev` (Astro dev server)
   - `lint`: runs `npm run lint` (Biome)
   - `build`: runs `npm run build:check` (full build with type check)
   - `format`: runs `npm run format` (Biome format)
   - `sync`: runs `npm run sync` (Astro content collections)

Include descriptive comments for each recipe (shown in `just --list`).
  </action>
  <verify>
Run `just --list` and confirm all recipes are listed with descriptions.
Run `just preview` and confirm Astro dev server starts.
  </verify>
  <done>
justfile exists with setup recipe and all development recipes callable via `just <name>`.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create interactive vault setup script</name>
  <files>scripts/setup.sh, .gitignore</files>
  <action>
Create `scripts/setup.sh` with:

1. Shebang and strict mode:
   ```bash
   #!/usr/bin/env bash
   set -euo pipefail
   ```

2. Color definitions for output:
   - RED for errors
   - GREEN for success
   - YELLOW for prompts/warnings
   - RESET for normal text

3. Auto-detection logic:
   - Search user's home directory for `.obsidian` folders (limit depth to avoid long searches)
   - Use `find "$HOME" -maxdepth 4 -type d -name ".obsidian" 2>/dev/null`
   - Extract parent directory (the vault path, not .obsidian itself)

4. Interactive selection:
   - If single vault found: show path with Y/n confirmation
   - If multiple vaults found: show numbered list, prompt for selection
   - If no vault found: prompt for manual path entry
   - Validate selected path has `.obsidian` directory

5. Config writing:
   - Create `.claude` directory if not exists
   - Write JSON to `.claude/settings.local.json`:
     ```json
     {
       "obsidianVaultPath": "/selected/path"
     }
     ```
   - Use `jq` if available, fallback to echo for JSON creation

6. Success output:
   - Show green checkmark with configured path
   - Mention that config is gitignored (local to this machine)

Make script executable: `chmod +x scripts/setup.sh`

Update `.gitignore`:
- Add `.claude/settings.local.json` to gitignore
- Add comment explaining it's local config
  </action>
  <verify>
1. Run `just setup` and verify:
   - Vault detection runs and shows found vaults
   - Selection prompt works
   - Config file is created at `.claude/settings.local.json`
   - Success message displays

2. Verify `.claude/settings.local.json` contains valid JSON with `obsidianVaultPath`

3. Run `git status` and verify `.claude/settings.local.json` is NOT listed (gitignored)
  </verify>
  <done>
`just setup` successfully detects Obsidian vaults, allows user selection, and writes config to gitignored local settings file.
  </done>
</task>

</tasks>

<verification>
1. `just --list` shows all recipes with descriptions
2. `just setup` runs interactive vault configuration
3. After setup, `.claude/settings.local.json` exists with valid JSON containing obsidianVaultPath
4. `.claude/settings.local.json` is gitignored (not tracked by git)
5. `just preview` starts Astro dev server
</verification>

<success_criteria>
- justfile exists and is recognized by `just` command
- All development recipes (preview, lint, build, format, sync) work
- Setup recipe runs interactive configuration
- Vault path is persisted to local config file
- Local config is gitignored
</success_criteria>

<output>
After completion, create `.planning/phases/07-setup-safety/07-01-SUMMARY.md`
</output>
