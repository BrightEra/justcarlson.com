---
phase: 15-library-extraction-yq-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .devcontainer/devcontainer.json
  - scripts/lib/common.sh
autonomous: true

must_haves:
  truths:
    - "yq --version returns mikefarah/yq v4.x in devcontainer"
    - "common.sh exists and can be sourced without errors"
    - "Color constants and config paths are defined as readonly"
  artifacts:
    - path: "scripts/lib/common.sh"
      provides: "Shared library with color constants, config constants, exit codes"
      contains: "readonly _COMMON_SH_LOADED=1"
    - path: ".devcontainer/devcontainer.json"
      provides: "yq v4 installation via devcontainer feature"
      contains: "ghcr.io/eitsupi/devcontainer-features/jq-likes"
  key_links:
    - from: "scripts/lib/common.sh"
      to: "sourcing scripts"
      via: "BASH_SOURCE pattern"
      pattern: "_COMMON_SH_LOADED"
---

<objective>
Install mikefarah/yq v4 in the devcontainer and create the scripts/lib/common.sh shared library skeleton with color constants, configuration constants, and exit codes.

Purpose: Establish the foundation for script deduplication. yq enables reliable YAML frontmatter manipulation that sed/grep cannot handle (quoted values, arrays, multiline). The shared library provides a single source of truth for constants duplicated across 5 scripts.

Output: devcontainer.json with yq feature, scripts/lib/common.sh with constants and guard pattern
</objective>

<execution_context>
@/home/jc/.claude/get-shit-done/workflows/execute-plan.md
@/home/jc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-library-extraction-yq-integration/15-RESEARCH.md
@.devcontainer/devcontainer.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add yq to devcontainer</name>
  <files>.devcontainer/devcontainer.json</files>
  <action>
Add the jq-likes devcontainer feature to install mikefarah/yq v4.

In the "features" object, add:
```json
"ghcr.io/eitsupi/devcontainer-features/jq-likes:2": {
  "yqVersion": "4"
}
```

This installs mikefarah/yq (Go version, not Python kislyuk/yq) with the --front-matter flag needed for markdown files.

Also add a note to README.md Prerequisites section about local yq installation:
- Arch Linux: `pacman -S go-yq`
- macOS: `brew install yq`
- Ubuntu: Download binary from https://github.com/mikefarah/yq/releases

Note: The system currently has kislyuk/yq 3.4.3 (Python). This is a DIFFERENT tool. mikefarah/yq has different syntax and the required --front-matter flag.
  </action>
  <verify>
Rebuild devcontainer and run: `yq --version`
Should output: `yq (https://github.com/mikefarah/yq/) version v4.x.x`
NOT: `yq 3.4.3` (that's the wrong yq)
  </verify>
  <done>
devcontainer.json includes jq-likes feature with yqVersion: 4
yq --version in devcontainer shows mikefarah/yq v4.x
  </done>
</task>

<task type="auto">
  <name>Task 2: Create common.sh library skeleton</name>
  <files>scripts/lib/common.sh</files>
  <action>
Create the shared library file at scripts/lib/common.sh with:

1. Shebang and header comment explaining purpose
2. Double-source guard using _COMMON_SH_LOADED
3. Strict mode (set -euo pipefail)
4. Color constants (readonly): RED, GREEN, YELLOW, CYAN, BLUE, RESET
5. Configuration constants (readonly): CONFIG_FILE, BLOG_DIR, ASSETS_DIR
6. Exit codes (readonly): EXIT_SUCCESS, EXIT_ERROR, EXIT_CANCELLED

Structure the file with section headers (# ========) matching existing script style.

Use readonly for all constants to prevent accidental modification.

The guard pattern:
```bash
[[ -n "${_COMMON_SH_LOADED:-}" ]] && return
readonly _COMMON_SH_LOADED=1
```

DO NOT include functions yet - those come in Plan 02.

Create the scripts/lib/ directory if it doesn't exist.
  </action>
  <verify>
1. File exists: `ls scripts/lib/common.sh`
2. Can be sourced: `bash -c 'source scripts/lib/common.sh && echo "OK"'`
3. Constants defined: `bash -c 'source scripts/lib/common.sh && echo $RED'`
4. Double-source safe: `bash -c 'source scripts/lib/common.sh; source scripts/lib/common.sh && echo "OK"'`
5. shellcheck passes: `shellcheck scripts/lib/common.sh`
  </verify>
  <done>
scripts/lib/common.sh exists with color constants, config constants, exit codes
File can be sourced without errors
shellcheck reports no issues
Double-sourcing is safe (guard works)
  </done>
</task>

</tasks>

<verification>
After both tasks:
1. `yq --version` in devcontainer shows mikefarah/yq v4.x
2. `source scripts/lib/common.sh` works from any directory
3. `shellcheck scripts/lib/common.sh` passes
4. Constants are readonly and properly scoped
</verification>

<success_criteria>
- devcontainer.json updated with yq feature
- scripts/lib/common.sh created with constants
- yq available in devcontainer (v4.x)
- Library can be sourced without side effects
- shellcheck passes on new file
</success_criteria>

<output>
After completion, create `.planning/phases/15-library-extraction-yq-integration/15-01-SUMMARY.md`
</output>
