---
phase: 12-bootstrap-portability
plan: 02
type: execute
wave: 2
depends_on: ["01"]
files_modified:
  - .devcontainer/devcontainer.json
autonomous: true

must_haves:
  truths:
    - "Opening project in VS Code offers 'Reopen in Container'"
    - "Container starts with all dependencies installed"
    - "Dev server works inside container with port forwarding"
    - "GitHub Codespaces can open this repo and run immediately"
  artifacts:
    - path: ".devcontainer/devcontainer.json"
      provides: "Dev container configuration"
      min_lines: 20
      contains: "mcr.microsoft.com/devcontainers"
  key_links:
    - from: ".devcontainer/devcontainer.json"
      to: "just bootstrap"
      via: "postCreateCommand"
      pattern: "postCreateCommand.*bootstrap"
    - from: ".devcontainer/devcontainer.json"
      to: "port 4321"
      via: "forwardPorts"
      pattern: "forwardPorts.*4321"
---

<objective>
Create dev container configuration for instant contribution via VS Code or GitHub Codespaces.

Purpose: Contributors can spin up a ready-to-code environment with one click. No local setup required.
Output: .devcontainer/devcontainer.json with Node 22, just, gh CLI, named volume, auto-bootstrap
</objective>

<execution_context>
@/home/jc/.claude/get-shit-done/workflows/execute-plan.md
@/home/jc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/12-bootstrap-portability/12-CONTEXT.md
@.planning/phases/12-bootstrap-portability/12-RESEARCH.md

@justfile
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create devcontainer.json</name>
  <files>.devcontainer/devcontainer.json</files>
  <action>
Create `.devcontainer/devcontainer.json` following RESEARCH.md patterns exactly.

Configuration:
```json
{
  "name": "justcarlson.com",
  "image": "mcr.microsoft.com/devcontainers/javascript-node:22",
  "features": {
    "ghcr.io/devcontainers/features/github-cli:1": {},
    "ghcr.io/guiyomh/features/just:0": {}
  },
  "mounts": [
    "source=${localWorkspaceFolderBasename}-node_modules,target=${containerWorkspaceFolder}/node_modules,type=volume"
  ],
  "postCreateCommand": "sudo chown node node_modules && just bootstrap",
  "forwardPorts": [4321],
  "portsAttributes": {
    "4321": {
      "label": "Astro Dev Server",
      "onAutoForward": "openPreview"
    }
  },
  "customizations": {
    "vscode": {
      "extensions": [
        "astro-build.astro-vscode",
        "bradlc.vscode-tailwindcss",
        "biomejs.biome",
        "eamodio.gitlens",
        "usernamehw.errorlens",
        "esbenp.prettier-vscode"
      ],
      "settings": {
        "editor.formatOnSave": true,
        "editor.defaultFormatter": "biomejs.biome"
      }
    }
  }
}
```

Key points from RESEARCH.md:
- Use official Node 22 devcontainer image (not custom Dockerfile)
- Named volume for node_modules (performance on macOS/Windows)
- sudo chown node node_modules before just bootstrap (volume ownership fix)
- Port 4321 is Astro's default dev port
- onAutoForward: "openPreview" uses VS Code Simple Browser (not external browser)
- Extensions match project stack: Astro, Tailwind, Biome (project's linter, replacing ESLint/Prettier), GitLens, ErrorLens, Prettier (for non-JS files)

Note: Astro dev server needs --host flag to be accessible from outside container. Check if justfile preview recipe already has this, or if we need to add it.
  </action>
  <verify>
    - `.devcontainer/devcontainer.json` exists and is valid JSON: `cat .devcontainer/devcontainer.json | jq .`
    - Contains Node 22 image
    - Contains just feature
    - Contains github-cli feature
    - Contains node_modules volume mount
    - Contains postCreateCommand with just bootstrap
    - Contains forwardPorts with 4321
  </verify>
  <done>Dev container config enables one-click container setup with all tools</done>
</task>

<task type="auto">
  <name>Task 2: Ensure Astro dev server binds to all interfaces</name>
  <files>justfile</files>
  <action>
Check if Astro dev server is accessible from outside the container. The dev server needs to bind to 0.0.0.0 (--host flag) for port forwarding to work.

1. Check current `preview` recipe in justfile
2. If it just runs `npm run dev`, update to `npm run dev -- --host` or add --host to the npm script

The --host flag makes Astro listen on all network interfaces, which is required for:
- Docker container port forwarding
- GitHub Codespaces
- Accessing dev server from other devices on network

Update the preview recipe:
```just
# Start Astro dev server (accessible from container/network)
preview:
    npm run dev -- --host
```
  </action>
  <verify>
    - `just preview` includes --host flag (visible in output or check justfile)
    - Dev server shows "Network: http://0.0.0.0:4321" in addition to localhost
  </verify>
  <done>Dev server accessible from container and network via --host flag</done>
</task>

</tasks>

<verification>
1. JSON validation:
   - `cat .devcontainer/devcontainer.json | jq .` parses without error

2. Container simulation (if Docker available):
   - VS Code with Dev Containers extension should offer "Reopen in Container"
   - Note: Full container test requires Docker - verify config structure instead

3. Network binding:
   - `just preview` shows Network: http://0.0.0.0:4321 in output

4. Feature verification:
   - devcontainer.json includes github-cli feature
   - devcontainer.json includes just feature
   - devcontainer.json uses named volume for node_modules
</verification>

<success_criteria>
- .devcontainer/devcontainer.json is valid and complete
- Dev server binds to 0.0.0.0 for container access
- Configuration matches RESEARCH.md recommendations exactly
- GitHub Codespaces-ready (standard devcontainer spec)
</success_criteria>

<output>
After completion, create `.planning/phases/12-bootstrap-portability/12-02-SUMMARY.md`
</output>
