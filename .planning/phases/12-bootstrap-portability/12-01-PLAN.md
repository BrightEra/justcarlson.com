---
phase: 12-bootstrap-portability
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .nvmrc
  - scripts/bootstrap.sh
  - justfile
  - README.md
  - src/content.config.ts
autonomous: true

must_haves:
  truths:
    - "Running `just bootstrap` installs npm dependencies and validates setup"
    - "Running `just preview` and `npm run build:check` without vault configured shows empty blog (no crash)"
    - "README Quick Start guides new users from clone to preview"
    - "Node version managers (nvm/fnm/mise) auto-switch to Node 22"
  artifacts:
    - path: ".nvmrc"
      provides: "Node version pin"
      contains: "22"
    - path: "scripts/bootstrap.sh"
      provides: "Idempotent bootstrap script"
      min_lines: 20
    - path: "justfile"
      provides: "bootstrap recipe"
      contains: "bootstrap"
    - path: "README.md"
      provides: "Quick Start section"
      contains: "Quick Start"
  key_links:
    - from: "justfile"
      to: "scripts/bootstrap.sh"
      via: "bootstrap recipe"
      pattern: "bootstrap.*bootstrap.sh"
    - from: "src/content.config.ts"
      to: "empty array fallback"
      via: "vault-optional loading"
      pattern: "\\[\\]|empt"
---

<objective>
Create one-command bootstrap for fresh clones and enable vault-optional preview mode.

Purpose: New contributors can spin up the project without friction. Code exploration works without vault configuration.
Output: .nvmrc, bootstrap script, justfile updates, README Quick Start, vault-optional content loading
</objective>

<execution_context>
@/home/jc/.claude/get-shit-done/workflows/execute-plan.md
@/home/jc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/12-bootstrap-portability/12-CONTEXT.md
@.planning/phases/12-bootstrap-portability/12-RESEARCH.md

@justfile
@scripts/setup.sh
@README.md
@src/content.config.ts
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create .nvmrc and bootstrap script</name>
  <files>.nvmrc, scripts/bootstrap.sh</files>
  <action>
1. Create `.nvmrc` with content `22` (major version only for auto patch updates)

2. Create `scripts/bootstrap.sh` (make executable) with idempotent logic:
   - Full verbose output (show everything including command output)
   - Check prerequisites: Node version matches .nvmrc (warn if mismatch, suggest nvm use)
   - Check prerequisites: npm available (fail with install link if missing)
   - Install npm dependencies: `npm install`
   - Run validation: `npm run build:check`
   - Start dev server briefly to confirm it works: start `npm run dev`, wait for "Local" output, then kill
   - Print success message with "Bootstrap complete! Run 'just preview' to start dev server."
   - Use set -euo pipefail for fail-fast
   - Use colors for output (GREEN for success, YELLOW for info, RED for errors)
   - Each step should echo what it's doing before running

Note: Project uses npm (not pnpm) per package-lock.json. Project uses Biome for linting (not ESLint/Prettier).
Reference patterns from existing setup.sh for color constants and style.
  </action>
  <verify>
    - `cat .nvmrc` shows `22`
    - `bash scripts/bootstrap.sh` runs without error (from fresh npm cache: `rm -rf node_modules && npm cache clean --force`)
    - Script is executable: `ls -la scripts/bootstrap.sh` shows -rwxr-xr-x
    - Script checks Node version against .nvmrc (grep for "node" and "version" in script)
  </verify>
  <done>.nvmrc pins Node 22, bootstrap.sh installs deps and validates with verbose output</done>
</task>

<task type="auto">
  <name>Task 2: Add bootstrap recipe and vault-optional preview</name>
  <files>justfile, src/content.config.ts</files>
  <action>
1. Update `justfile` to add bootstrap recipe after setup:
   ```just
   # Bootstrap development environment (idempotent)
   bootstrap:
       ./scripts/bootstrap.sh
   ```

2. Update `src/content.config.ts` to handle missing vault gracefully:
   - The content loader should not crash when vault is not configured
   - If no posts found (empty vault or no vault), return empty array
   - Add a console.log message: "No vault configured - running in code exploration mode" when vault path is missing or invalid
   - Keep existing behavior when vault IS configured

Look at existing content.config.ts to understand the loader pattern. The key is making the glob/file loading graceful when the vault path doesn't exist.

Note: The project uses Astro content collections with a custom loader. Check if there's external content being loaded from Obsidian vault vs just local content in src/content/blog.
  </action>
  <verify>
    - `just bootstrap` runs bootstrap.sh
    - `just preview` works without vault configured (temporarily rename .claude/settings.local.json to test, then restore)
    - `npm run build:check` works without vault configured (same test: rename settings.local.json, run build, restore)
    - No crash when vault missing - site loads with empty blog
  </verify>
  <done>justfile has bootstrap recipe, preview and build work without vault (shows empty blog)</done>
</task>

<task type="auto">
  <name>Task 3: Update README with Quick Start</name>
  <files>README.md</files>
  <action>
Update README.md with comprehensive Quick Start section. Follow CONTEXT.md decision: "Assume nothing - link to prerequisites for everything (most accessible)".

Structure:
1. Add "Prerequisites" section listing requirements with install links:
   - Node.js 22+ (link to nodejs.org or nvm)
   - just command runner (link to just.systems)
   - npm (comes with Node.js)

2. Add "Quick Start" section:
   ```
   ## Quick Start

   git clone https://github.com/justcarlson/justcarlson.com.git
   cd justcarlson.com
   just bootstrap
   just preview
   ```
   Then: "Open http://localhost:4321 in your browser"

3. Add "Obsidian Integration" section explaining:
   - This blog supports publishing from Obsidian
   - Run `just setup` to configure your vault path
   - See `just --list` for all available commands

4. Add "Common Issues" section with 3-5 gotchas:
   - Node version mismatch: "Run `nvm use` or install Node 22"
   - just not found: Link to installation
   - Permission denied on scripts: "Run `chmod +x scripts/*.sh`"
   - Port already in use: "Another dev server running? Kill it or use a different port"

Keep existing content (Overview, Development, Deployment, Credits, License) but reorganize so Quick Start is near the top.
  </action>
  <verify>
    - README.md contains "Quick Start" section
    - README.md contains "Prerequisites" section with links
    - README.md contains "Common Issues" section
    - README.md mentions `just bootstrap` command
  </verify>
  <done>README guides new users from clone to preview with prerequisites and troubleshooting</done>
</task>

</tasks>

<verification>
1. Fresh clone simulation:
   - `rm -rf node_modules`
   - `just bootstrap` completes successfully
   - `just preview` starts dev server

2. Vault-optional mode:
   - Temporarily move `.claude/settings.local.json` aside
   - `just preview` shows site with empty blog (no crash)
   - Restore settings.local.json

3. Node version:
   - `cat .nvmrc` shows 22
   - `nvm use` (if nvm installed) reads from .nvmrc
</verification>

<success_criteria>
- `just bootstrap` installs deps and validates in one command
- `just preview` works without vault (empty blog, no crash)
- README Quick Start is clear and complete
- .nvmrc pins Node 22
</success_criteria>

<output>
After completion, create `.planning/phases/12-bootstrap-portability/12-01-SUMMARY.md`
</output>
